<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L√¥ T√¥ - Tr√≤ Ch∆°i S·ªë</title>
    <meta name="description" content="Ch∆°i L√¥ T√¥ tr·ª±c tuy·∫øn v·ªõi b·∫°n b√® - kh√¥ng c·∫ßn server!">

    <!-- External Dependencies -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Oswald:wght@500;700&family=Anton&display=swap"
        rel="stylesheet">

    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <div id="danmaku-container" class="danmaku-container"></div>

    <!-- Decorative Background -->
    <div class="bg-decoration">
        <div class="lantern lantern-1"></div>
        <div class="lantern lantern-2"></div>
        <div class="sparkle sparkle-1"></div>
        <div class="sparkle sparkle-2"></div>
        <div class="sparkle sparkle-3"></div>
    </div>

    <!-- Main App Container -->
    <div id="app">
        <!-- Home Screen -->
        <div id="home-screen" class="screen active">
            <!-- Home Settings Button (Absolute Top Right) -->
            <button id="btn-settings-home" class="btn-icon-only"
                style="position: absolute; top: 20px; right: 20px; z-index: 10;" aria-label="C√†i ƒë·∫∑t">
                <i class="fa-solid fa-gear"></i>
            </button>
            <div class="home-content">
                <div class="logo-container">
                    <h1 class="logo">üé∞ L√¥ T√¥</h1>
                    <p class="tagline">Tr√≤ ch∆°i s·ªë may m·∫Øn</p>
                </div>

                <div class="home-buttons">
                    <button id="btn-host" class="btn btn-primary btn-large"
                        aria-label="L√†m Ch·ªß X∆∞·ªõng - T·∫°o ph√≤ng v√† x∆∞·ªõng s·ªë">
                        <span class="btn-icon">üì£</span>
                        <span class="btn-text">L√†m Ch·ªß X∆∞·ªõng</span>
                        <span class="btn-desc">T·∫°o ph√≤ng & x∆∞·ªõng s·ªë</span>
                    </button>

                    <button id="btn-join" class="btn btn-secondary btn-large"
                        aria-label="Tham Gia - Qu√©t m√£ QR ho·∫∑c nh·∫≠p m√£">
                        <span class="btn-icon">üéÆ</span>
                        <span class="btn-text">Tham Gia</span>
                        <span class="btn-desc">Qu√©t m√£ QR ho·∫∑c nh·∫≠p m√£</span>
                    </button>
                </div>

                <div class="home-footer">
                    <p>üåê Ch∆°i Online M·ªçi N∆°i ‚Ä¢ Kh√¥ng c·∫ßn ƒëƒÉng k√Ω</p>
                </div>
            </div>
        </div>

        <!-- Host Screen -->
        <div id="host-screen" class="screen">
            <header class="game-header">
                <button id="btn-back-host" class="btn-icon-only" aria-label="Quay l·∫°i trang ch·ªß"><i
                        class="fa-solid fa-arrow-left"></i></button>
                <h2>Ch·ªß X∆∞·ªõng</h2>
                <button id="btn-view-players" class="btn-icon-only" aria-label="Danh s√°ch ng∆∞·ªùi ch∆°i">
                    <i class="fa-solid fa-users"></i>
                    <span id="player-count" class="badge">0</span>
                </button>
                <button id="btn-settings-host" class="btn-icon-only" aria-label="C√†i ƒë·∫∑t">
                    <i class="fa-solid fa-gear"></i>
                </button>
            </header>

            <div class="host-layout">
                <!-- Left Column: Main Number Display -->
                <div class="host-main">
                    <!-- QR Code Section (Moved) -->
                    <div class="qr-section glass-card compact">
                        <div class="qr-header">
                            <h3>M√£ Ph√≤ng</h3>
                            <button id="btn-toggle-qr" class="btn-icon-only btn-small" aria-label="Hi·ªán/·∫®n QR"><i
                                    class="fa-solid fa-chevron-up"></i></button>
                        </div>
                        <div class="room-code-group">
                            <div class="room-code-display" id="room-code-display">------</div>
                            <button id="btn-copy-code" class="btn-icon-only" aria-label="Sao ch√©p m√£ ph√≤ng"><i
                                    class="fa-regular fa-clipboard"></i></button>
                        </div>
                        <div id="qrcode" class="qrcode-container"></div>
                    </div>

                    <!-- Current Number Display -->
                    <div class="current-number-section glass-card">
                        <div class="number-ball-container">
                            <div class="number-ball" id="current-number">
                                <span>?</span>
                            </div>
                        </div>
                        <p class="rhyme-text" id="number-text">B·∫•m ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                    </div>

                    <!-- Draw Button -->
                    <button id="btn-draw" class="btn btn-draw" disabled aria-label="X∆∞·ªõng s·ªë m·ªõi">
                        <span class="draw-icon"><i class="fa-solid fa-dice fa-lg"></i></span>
                        <span>X∆∞·ªõng S·ªë</span>
                    </button>

                    <div class="host-widgets-grid">
                        <!-- Game Controls (Merged) -->
                        <div class="game-controls glass-card">
                            <h3><i class="fa-solid fa-gamepad"></i> ƒêi·ªÅu Khi·ªÉn Game</h3>

                            <!-- Auto Draw Section -->
                            <div class="control-section">
                                <div class="auto-draw-header">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-draw-toggle">
                                        <span class="slider"></span>
                                    </label>
                                    <span class="auto-draw-label">T·ª± ƒë·ªông x∆∞·ªõng</span>
                                </div>
                                <div class="auto-draw-speed" id="auto-draw-speed-container">
                                    <label>M·ªói:</label>
                                    <select id="auto-draw-interval">
                                        <option value="3000">3 gi√¢y</option>
                                        <option value="5000" selected>5 gi√¢y</option>
                                        <option value="8000">8 gi√¢y</option>
                                        <option value="10000">10 gi√¢y</option>
                                        <option value="15000">15 gi√¢y</option>
                                    </select>
                                </div>
                            </div>

                            <div class="divider"></div>

                            <!-- TTS Section -->
                            <div class="control-section">
                                <h4><i class="fa-solid fa-microphone-lines"></i> Gi·ªçng N√≥i</h4>
                                <div class="control-row">
                                    <label>T·ªëc ƒë·ªô:</label>
                                    <input type="range" id="tts-speed" min="0.5" max="1.5" step="0.1" value="0.9">
                                    <span id="speed-value">0.9x</span>
                                </div>
                                <div class="control-row">
                                    <label>√Çm l∆∞·ª£ng:</label>
                                    <input type="range" id="tts-volume" min="0" max="1" step="0.1" value="1">
                                    <span id="volume-value">100%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Music Player -->
                        <div class="music-player glass-card">
                            <h3><i class="fa-solid fa-music"></i> Nh·∫°c T·∫øt üßß</h3>
                            <div class="music-controls">
                                <button id="btn-music-prev" class="btn-icon-only btn-small" aria-label="B√†i tr∆∞·ªõc">
                                    <i class="fa-solid fa-backward"></i>
                                </button>
                                <button id="btn-music-play" class="btn-icon-only" aria-label="Ph√°t/D·ª´ng">
                                    <i class="fa-solid fa-play"></i>
                                </button>
                                <button id="btn-music-next" class="btn-icon-only btn-small" aria-label="B√†i sau">
                                    <i class="fa-solid fa-forward"></i>
                                </button>
                            </div>
                            <div class="music-info">
                                <span id="music-track-name">Ch·ªçn b√†i h√°t...</span>
                            </div>
                            <input type="range" id="music-volume" min="0" max="1" step="0.1" value="0.5">
                        </div>
                    </div>
                </div>

                <!-- Right Column: Room Info & Called Numbers -->
                <div class="host-sidebar">

                    <!-- Waiting List Section -->
                    <div id="waiting-list-section" class="glass-card hidden">
                        <h3 class="waiting-header"><i class="fa-solid fa-flag"></i> ƒêang ƒê·ª£i (C·ªù)</h3>
                        <div id="waiting-list" class="waiting-list">
                            <!-- Waiting players will be listed here -->
                        </div>
                    </div>

                    <!-- Player List Button (Moved to Header) -->




                    <!-- Called Numbers Grid -->
                    <div class="called-numbers glass-card">
                        <h3>S·ªë ƒê√£ X∆∞·ªõng (<span id="called-count">0</span>/90)</h3>
                        <div id="numbers-grid" class="numbers-grid">
                            <!-- Numbers 1-90 will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Player Screen -->
        <div id="player-screen" class="screen">
            <header class="game-header">
                <button id="btn-back-player" class="btn-icon-only" aria-label="Quay l·∫°i trang ch·ªß"><i
                        class="fa-solid fa-arrow-left"></i></button>
                <h2>Ng∆∞·ªùi Ch∆°i</h2>
                <div class="header-controls">
                    <button id="btn-settings-player" class="btn-icon-only" aria-label="C√†i ƒë·∫∑t">
                        <i class="fa-solid fa-gear"></i>
                    </button>
                    <div class="connection-status" id="connection-status">
                        <span class="status-dot"></span>
                        <span>ƒêang k·∫øt n·ªëi...</span>
                    </div>
                </div>
            </header>

            <div class="player-layout">
                <!-- Current Number Display (Received) - First on both mobile and desktop sidebar -->
                <div class="current-number-section glass-card">
                    <p class="label">S·ªë v·ª´a x∆∞·ªõng:</p>
                    <div class="number-ball-container">
                        <div class="number-ball" id="player-current-number">
                            <span>?</span>
                        </div>
                    </div>
                    <p class="rhyme-text" id="player-number-text">Ch·ªù ch·ªß x∆∞·ªõng...</p>
                </div>

                <!-- Player's Ticket - Second on mobile, Left column on desktop -->
                <div class="ticket-container glass-card">
                    <div class="ticket-header">
                        <h3><i class="fa-solid fa-ticket"></i> V√© L√¥ T√¥ C·ªßa B·∫°n</h3>
                        <div class="ticket-actions">
                            <button id="btn-open-shout" class="btn-icon-only" title="H√¥ H√†o" aria-label="H√¥ H√†o">
                                <i class="fa-solid fa-bullhorn"></i>
                            </button>
                            <button id="btn-add-sheet" class="btn-icon-only" title="Th√™m t·ªù m·ªõi"
                                aria-label="Th√™m t·ªù m·ªõi">
                                <i class="fa-solid fa-plus"></i>
                            </button>
                            <button id="btn-new-ticket" class="btn-icon-only" title="ƒê·ªïi t·∫•t c·∫£ v√©"
                                aria-label="ƒê·ªïi t·∫•t c·∫£ v√©">
                                <i class="fa-solid fa-rotate"></i>
                            </button>
                        </div>
                    </div>
                    <div id="player-ticket" class="loto-carousel">
                        <!-- Ticket cards will be generated here -->
                    </div>
                    <div id="pagination-dots" class="pagination-dots"></div>
                </div>

                <!-- Lotto Button - Third on mobile, Right column on desktop -->
                <button id="btn-loto" class="btn btn-loto" disabled aria-label="B√°o KINH khi ho√†n th√†nh m·ªôt h√†ng">
                    üéâ KINH!
                </button>

                <!-- Called Numbers (Compact) - Last on mobile, Right column on desktop -->
                <div class="called-numbers-compact glass-card">
                    <h3>S·ªë ƒê√£ X∆∞·ªõng</h3>
                    <div id="player-numbers-grid" class="numbers-grid small">
                        <!-- Numbers will be shown here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Restore Session Modal -->
        <div id="restore-modal" class="modal">
            <div class="modal-content glass-card">
                <div class="modal-header">
                    <h3><i class="fa-solid fa-clock-rotate-left"></i> Ph·ª•c H·ªìi V√°n Ch∆°i</h3>
                    <p>T√¨m th·∫•y d·ªØ li·ªáu v√°n ch∆°i c≈©.</p>
                </div>
                <div class="modal-body">
                    <p>B·∫°n c√≥ mu·ªën ti·∫øp t·ª•c v√°n ch∆°i tr∆∞·ªõc ƒë√≥ (M√£: <strong id="restore-room-code">...</strong>) kh√¥ng?
                    </p>
                    <p class="warning-text" style="color: var(--text-secondary); margin-bottom: 1.5rem;"><small>‚ö† Ch·ªçn
                            "V√°n M·ªõi" s·∫Ω xo√° k·∫øt qu·∫£ v√°n c≈©.</small></p>
                    <div class="modal-actions" style="display: flex; gap: 1rem; justify-content: center;">
                        <button id="btn-confirm-restore" class="btn btn-primary">
                            <i class="fa-solid fa-rotate-left"></i> Kh√¥i ph·ª•c
                        </button>
                        <button id="btn-reject-restore" class="btn btn-secondary"
                            style="color: var(--error); border-color: var(--error);">
                            <i class="fa-solid fa-trash"></i> V√°n M·ªõi
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Join Modal -->
        <div id="join-modal" class="modal">
            <div class="modal-content glass-card">
                <button class="modal-close" id="btn-close-join" aria-label="ƒê√≥ng"><i
                        class="fa-solid fa-xmark"></i></button>
                <div class="modal-header">
                    <h3><i class="fa-solid fa-ticket"></i> Tham Gia Ph√≤ng</h3>
                    <p>Nh·∫≠p m√£ ph√≤ng t·ª´ ch·ªß x∆∞·ªõng</p>
                </div>

                <div class="join-form">
                    <!-- QR Scanner Section (Primary) -->
                    <div id="qr-scanner-container">
                        <video id="qr-video"></video>
                    </div>

                    <button class="btn btn-secondary" id="btn-start-scan">
                        <i class="fa-solid fa-camera"></i> B·∫≠t Camera
                    </button>

                    <div class="divider">
                        <span>HO·∫∂C</span>
                    </div>

                    <!-- Manual Input Section -->
                    <div class="input-group">
                        <label>T√™n hi·ªÉn th·ªã (Tu·ª≥ ch·ªçn)</label>
                        <input type="text" id="player-name-input" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" maxlength="20">
                    </div>
                    <div class="input-group">
                        <label>M√£ Ph√≤ng</label>
                        <input type="text" id="room-code-input" placeholder="ABCDEF" maxlength="6">
                    </div>
                    <button class="btn btn-primary" id="btn-join-room">
                        <i class="fa-solid fa-right-to-bracket"></i> Tham Gia
                    </button>
                </div>
            </div>
        </div>

        <!-- Win Modal -->
        <div id="win-modal" class="modal">
            <div class="modal-content glass-card win-content">
                <div class="win-animation">
                    <div class="confetti"></div>
                    <h1>üéâ KINH R·ªíI! üéâ</h1>
                    <p id="winner-name">Ng∆∞·ªùi ch∆°i ƒë√£ th·∫Øng!</p>
                </div>
                <button id="btn-close-win" class="btn btn-primary">ƒê√≥ng</button>
            </div>
        </div>

        <!-- Player List Modal -->
        <div id="player-list-modal" class="modal">
            <div class="modal-content glass-card">
                <h2>Danh s√°ch ng∆∞·ªùi ch∆°i</h2>
                <div id="details-player-list" class="details-player-list">
                    <p class="empty-list-text">Ch∆∞a c√≥ ng∆∞·ªùi ch∆°i n√†o.</p>
                </div>
                <div class="modal-actions">
                    <button id="btn-close-player-list" class="btn btn-secondary">ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal">
            <div class="modal-content glass-card">
                <button class="modal-close" id="btn-close-settings" aria-label="ƒê√≥ng"><i
                        class="fa-solid fa-xmark"></i></button>
                <div class="modal-header">
                    <h3><i class="fa-solid fa-gear"></i> C√†i ƒê·∫∑t</h3>
                </div>

                <div class="settings-content">
                    <!-- Appearance -->
                    <div class="settings-group">
                        <h4>Giao Di·ªán</h4>
                        <div class="setting-item">
                            <span class="setting-label">Ch·∫ø ƒë·ªô T·ªëi (Dark Mode)</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-dark-mode">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item" id="setting-theme-container">
                            <span class="setting-label">M√†u V√©</span>
                            <div class="theme-selector">
                                <div class="theme-swatch swatch-blue active" data-theme="theme-blue"></div>
                                <div class="theme-swatch swatch-green" data-theme="theme-green"></div>
                                <div class="theme-swatch swatch-red" data-theme="theme-red"></div>
                                <div class="theme-swatch swatch-purple" data-theme="theme-purple"></div>
                                <div class="theme-swatch swatch-yellow" data-theme="theme-yellow"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Audio -->
                    <div class="settings-group">
                        <h4>√Çm Thanh</h4>
                        <div class="setting-item">
                            <span class="setting-label">Hi·ªáu ·ª©ng √¢m thanh</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-sfx" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">ƒê·ªçc s·ªë (TTS)</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-tts" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- System -->
                    <div class="settings-group">
                        <h4>H·ªá Th·ªëng</h4>
                        <button id="btn-reset-app" class="btn btn-small btn-secondary"
                            style="width: 100%; color: var(--error); border-color: var(--error);">
                            <i class="fa-solid fa-trash"></i> Xo√° d·ªØ li·ªáu & ƒê·∫∑t l·∫°i
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emote Container (Global) -->
        <div id="emote-container" class="emote-container"></div>

        <!-- Emote Bar (Player Only) -->
        <div id="emote-bar" class="emote-bar hidden">
            <button class="btn-emote" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
            <button class="btn-emote" data-emoji="üòÇ">üòÇ</button>
            <button class="btn-emote" data-emoji="üòÆ">üòÆ</button>
            <button class="btn-emote" data-emoji="üéâ">üéâ</button>
            <button class="btn-emote" data-emoji="üò°">üò°</button>
        </div>

        <!-- Toast Notifications -->
        <div id="toast-container"></div>

        <!-- Shout Modal -->
        <div id="shout-modal" class="modal">
            <div class="modal-content glass-card">
                <button class="modal-close" id="btn-close-shout" aria-label="ƒê√≥ng"><i
                        class="fa-solid fa-xmark"></i></button>
                <h3><i class="fa-solid fa-bullhorn"></i> H√¥ H√†o</h3>
                <p>Ch·ªçn c√¢u mu·ªën h√©t l√™n!</p>
                <div class="shout-grid" id="shout-grid">
                    <!-- Shout buttons generated by JS -->
                </div>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="confetti.js"></script>
    <script src="tts.js"></script>
    <script src="audio.js"></script>
    <script src="peer.js"></script>
    <script src="app.js"></script>
</body>

</html>